[Unit]
Description=restic backup for %i

[Service]
Type=oneshot
Environment=RESTIC_LOCKFILE=/run/restic/backup.lock
Environment=XDG_CACHE_HOME=/var/cache/restic
EnvironmentFile=-/etc/restic/restic.conf
EnvironmentFile=/etc/restic/%i/restic.conf
WorkingDirectory=/etc/restic/%i
IOSchedulingClass=idle
ExecStart=/usr/bin/flock --verbose $RESTIC_LOCKFILE \
	/usr/local/bin/restic $RESTIC_COMMON_ARGS \
	backup $RESTIC_BACKUP_ARGS $BACKUP_DIR
ExecStart=/usr/bin/flock --verbose $RESTIC_LOCKFILE \
	/usr/local/bin/restic $RESTIC_COMMON_ARGS \
	forget $RESTIC_FORGET_ARGS

[Install]
WantedBy=multi-user.target
